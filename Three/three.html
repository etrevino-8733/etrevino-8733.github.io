<style>
    .progress-bar-container{
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #progress-bar {
      width: 30%;
      margin-top: 0.5%;
      height: 2%;
    }

    label {
      color: white;
      font-size: 2rem;
    }
</style>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="three.css" asp-append-version="true"/>
</head>
<body>
    <main>
      <canvas id="bg"></canvas>
      <div class="progress-bar-container">
          <label for="progress-bar">Loading... </label>
          <div class="spinner"></div>
          <progress id="progress-bar" value="0" max="100"></progress>
      </div>
      <section>
        <div class="controls">
          <div>
            <button class="glow-on-hover" id="showGraphBtn">Show Graph</button>
            <button class="glow-on-hover" id="recenterBtn">Re-center</button>
          </div>
          <div class="control-inputs">
            <div style="display: flex; gap: 4px; width: 100%; height: 25px;">
              <input type="text" id="pipeNumberInput" style="flex: 1 1 auto;">
              <button class="glow-on-hover" style="height: inherit" id="pipeFocus">View Pipe</button>
              <input type="hidden" id="previousPipeNumber">
            </div>
            <div style="display: flex; gap: 4px; width: 100%; height: 25px;">
              <select id="pipeGroupInput" style="flex: 1 1 auto" >
                <option value="">Select One</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
                <option value="yellow">Yellow</option>
              </select>
              <button class="glow-on-hover" style="height: inherit"  id="pipeGroups">View Grade Group</button>  
            </div>
          </div>
        </div>

      </section>
      <div id="graph">
        <div style="position: absolute; top: 0; right: 0; padding: 2px">
          <button onclick="hideGraph()" style="background-color: inherit; border: 2px solid gray; color: white; border-radius: 50px; aspect-ratio: 1/1;">X</button>
        </div>ÃŸ
        <canvas id="rodChart" ></canvas>
      </div>
      <div style="position: fixed; top: 95%; width: 98%; text-align: right; font-size: 10px;"><span>Pump jack model based on <a target="_blank" href="https://sketchfab.com/3d-models/oil-pump-jack-08f0fc1d37d74831912c7b9c59c84d5a">"Oil Pump Jack"</a> <br/> by <a target="_blank" href="https://sketchfab.com/_._bespalov_._">_._bespalov_._</a> licensed under <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/"> CC-BY-4.0 </a> </span></div>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script type="importmap">
        {
          "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
          }
        }
    </script>
    <script>
      document.getElementById("showGraphBtn").addEventListener("click", function(){
        var x = document.getElementById("graph");
        var chart = document.getElementById('rodChart');
        if (!x.classList.contains('active')) {
          x.classList.add('active');
          this.innerText = "Hide Graph"
        } else {
          x.classList.remove('active');
          this.innerText = "Show Graph"
        }
      });
      function hideGraph(){
        var x = document.getElementById("graph");
        var chart = document.getElementById('rodChart');
        if (x.classList.contains('active')) {
          x.classList.remove('active');
          document.getElementById("showGraphBtn").innerText = "Show Graph"
        }
      }
    </script>
    <script type="text/javascript">
        var pipeDataList = [];
        var xRod = [];
        var yRod = [];
        var rodColors = [];
        var rodChart;

        
        fetch("../api/threeChart.txt")
            .then((res) => res.text())
            .then((text) => {
                var chartData = JSON.parse(text);
                xRod = chartData.overallX;
                yRod = chartData.overallY;
                rodColors = chartData.overallColor;

                setChart();
            })
        .catch((e) => console.error(e));

        fetch("../api/three.txt")
            .then((res) => res.text())
            .then((text) => {
                pipeDataList = JSON.parse(text);
            })
            .catch((e) => console.error(e));
        


        function setChart(){
            rodChart = new Chart("rodChart", {
            type: "bar",
            data: {
                labels: xRod,
                datasets: [{
                backgroundColor: rodColors,
                data: yRod,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: 'white'
                }]
            },
            options: {
                legend: {display: false},
                title: {
                display: true,
                text: "Click on a chart value to see details"
                },
                scales: {
                    yAxes: [{
                        ticks: {
                                beginAtZero: true
                        },
                        gridLines:{
                        color: "gray",
                        lineWidth:1
                        }
                    }]
                }
            }
            });
        }

    </script>
    <script type="module" src="three.js"></script>
</body>
</html>